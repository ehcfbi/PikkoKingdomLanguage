<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PikkoKingdomLanguage</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="keyboard">
        <button class="key"><img src="char_koigh.png" alt="koigh" class="char_koigh"></button>
        <button class="key"><img src="char_yaigh.png" alt="yaigh" class="char_yaigh"></button>
        <button class="key"><img src="char_pikko.png" alt="pikko"></button>
        <button class="key"><img src="char_shie.png" alt="shie"></button>
        <button class="key"><img src="char_di.png" alt="di" class="char_di"></button>
        <button class="key"><img src="char_niekae.png" alt="niekae""></button>
        <button class="key"><img src="char_pi.png" alt="pi"></button>
        <!-- 他の文字も同様に追加 -->
        <button id="newline" class="key">Enter</button>
    </div>
    <div id="output" class="output"></div>
    <script>
        document.querySelectorAll('.key').forEach(button => {
            button.addEventListener('click', () => {
                const outputDiv = document.getElementById('output');
                if (button.id === "newline") {
                    // 改行を追加
                    const line = document.createElement('div');
                    line.classList.add('line');
                    outputDiv.appendChild(line);
                } else {
                    const charImage = button.querySelector('img').cloneNode(true);
                    let lastLine = outputDiv.lastElementChild;

                    // 最初の改行前に文字が挿入される場合を処理
                    if (!lastLine || !lastLine.classList.contains('line')) {
                        lastLine = document.createElement('div');
                        lastLine.classList.add('line');
                        outputDiv.appendChild(lastLine);
                    }

                    const lines = document.querySelectorAll('.line');
                    const isEvenLine = (lines.length % 2 === 0);

                    if (isEvenLine) {
                        // 偶数行の場合は逆順に挿入
                        lastLine.insertBefore(charImage, lastLine.firstChild);
                    } else {
                        // 奇数行の場合は順序通りに挿入
                        lastLine.appendChild(charImage);
                    }

                    // 文字列の組み合わせを監視
                    checkCombination(outputDiv, isEvenLine);
                }
            });
        });

        function checkCombination(outputDiv, isEvenLine) {
            const lines = document.querySelectorAll('.line');

            lines.forEach(line => {
                let classCombination = '';
                line.childNodes.forEach(img => {
                    img.classList.forEach(className => {
                        if (className.startsWith('char')) {
                            classCombination += className + ' ';
                        }
                    });
                });

                classCombination = classCombination.trim();

                // 特定のクラスの組み合わせを検出して画像を変更
                if (classCombination.includes('char_koigh char_yaigh')) { // 例えば、char_aとchar_bが続けて入力された場合
                    const newCharImage = document.createElement('img');
                    newCharImage.src = 'new_char_koigh,yaigh.png'; // 新しい画像ファイルのパス
                    newCharImage.alt = 'koigh,yaigh';
                    newCharImage.classList.add('char_koigh,yaigh');

                    // 元の要素を削除
                    while (line.firstChild) {
                        line.removeChild(line.firstChild);
                    }
                    // 新しい要素を挿入
                    line.appendChild(newCharImage);

                    if (isEvenLine) {
                        // 偶数行の場合は左右反転
                        newCharImage.classList.add('flip-horizontal');
                    }
                }
            });
        }
    </script>
</body>
</html>
